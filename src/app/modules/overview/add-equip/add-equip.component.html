
<div class="view_equip">
  <div class="veq_head">
    <h6 *ngIf="!editName">
      {{ name }}
      <a class="text-muted text-sm-left" (click)="editName = !editName"
         style="cursor: pointer; text-decoration: underline; font-size: 12px;" title="">
        <img src="assets/icons/edit.png" alt="">
      </a>
    </h6>
    <div *ngIf="editName" style="width: 200px; display: inline-block;">
        <div class="input-group">
          <input [(ngModel)]="name" type="text" class="form-control">
          <span class="input-group-append">
            <button class="btn btn_info" (click)="editName = false" [disabled]="!name">确定</button>
          </span>
        </div>
      </div>



    <div class="view_step">
      <a class="btn btn_info">添加设备</a>
      <div class="step_c"></div>
      <a class="btn btn_grey">选择终端</a>
      <div class="step_c"></div>
      <a class="btn btn_grey">配置模板</a>

    </div>
  </div>

  <div class="veq_body">
    <h5 class="text-danger mb-3">必填信息</h5>
    <div class="row">
      <div class="form-group col-md-6">
        <div class="input-group">
        <span class="input-group-prepend">
          <span class="input-group-text">
            设备名称
          </span>
        </span>
          <input type="text" [(ngModel)]="data.name"
                 class="form-control"
                 placeholder="输入设备名称" required>
        </div>
      </div>
      <div class="form-group col-md-6">
        <div class="input-group">
          <span class="input-group-prepend">
            <span class="input-group-text">
              设备型态
            </span>
          </span>
          <select [(ngModel)]="data.templateId"
                  class="form-control">
            <option *ngFor="let temp of templates" [value]="temp.Uid" >{{temp.Name}}</option>
          </select>
          <span class="input-group-append">
            <a class="btn btn_info" (click)="addForm()">
              <i class="fa fa-plus" title="新增设备型态"></i>
            </a>
          </span>
        </div>
      </div>
    </div>
    <hr style="margin-top: 6px;">


    <!--企业关联-->
    <h5 class="mb-3 mt-lg-3">企业信息</h5>
    <div class="">
      <div class="row">

        <div class="form-group flex col-12" *ngFor="let link of links; let i = index">
          <div class="input-group" style="flex: 9;">
            <span class="input-group-prepend">
              <span class="input-group-text">
                {{link.typeName}}
              </span>
            </span>

            <nz-select nzShowSearch nzPlaceHolder="选择关联企业" [(ngModel)]="link.uid"
                       style="width: 76%;" [nzDisabled]="i===0 && currentUser.Role.RoleId > 1">
              <nz-option *ngFor="let option of link.orgs" [nzLabel]="option.Name" [nzValue]="option.Uid"></nz-option>
            </nz-select>
          </div>

          <div *ngIf="currentUser.Role.RoleId <= 10 && currentUser.Organization && currentUser.Organization.IsEptCtl" style="flex: 2">
            <span class="ml-3"> 控制 </span>
            <label class="switch switch-lg" style="margin-bottom: 0;">
              <input type="checkbox" [(ngModel)]="link.eptCtlPlg"  />
              <span></span>
            </label>
          </div>

        </div>

      </div>

    </div>

    <!--其他信息-->
    <h5 class="text_info mb-3 mt-lg-3">选填信息</h5>
    <div class="row">
      <div class="col-12">
        <div class="form-group flex" *ngFor="let info of info; let i = index">
          <div class="input-group" style="width: 90%;">
            <input type="text" [(ngModel)]="info.title" class="form-control" [class.input-group-text]="info.title" style="width: 25%;" placeholder="请输入信息类型">
            <input type="text" [(ngModel)]="info.value" class="form-control" style="width: 75%;" placeholder="请输入信息内容" [disabled]="!info.title">
          </div>
          <div>
            <button (click)="removeInfo(i);"
                    class="btn btn-outline-danger btn-sm" style=" margin-left: 10px; border-radius: 25px;">
              <i class="fa fa-minus" style="font-size: 12px;"></i>
            </button>
          </div>

        </div>

        <button type="button"
                (click)="addNewInfo();"
                class="btn btn-block btn_info">
          <i class="fa fa-plus-circle"></i>
          添加其他信息
        </button>
      </div>

    </div>


    <!--上传图片-->
    <h5 class="mb-3 mt-lg-3">上传设备图片</h5>
    <div class="row">
      <div class="col-12">
        <div class="pull-left" style="width: 200px; height: 150px; overflow: hidden;">
          <img src="{{imgUrl}}" title="点击上传图片" style="width: 200px; height: 150px;">
          <input type="file"  (change)="imgChange($event)" style="position: absolute; left: 0; top: 0; opacity: 0; width: 210px; height: 150px;">
        </div>

        <div class="pull-left ml-5" style="width: 50%;">
          <p>
            请点击左侧图片选择要上传的设备图片，<br/>
            文件格式请用jpg、png或gif，文件大小不超过200k
          </p>
          <p class="text-danger">
            {{errMes}}
          </p>

        </div>

      </div>

    </div>
  </div>

  <div class="veq_bottom">
    <button class="btn btn_info float-right"
            [disabled]="!data.name"
            nz-button [nzLoading]="isLoading" (click)="save()">
      下一步
    </button>
  </div>


</div>
