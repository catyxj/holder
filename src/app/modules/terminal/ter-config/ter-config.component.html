
<div class="content">
  <div class="mat-card-title" style="padding-top: 20px; padding-bottom: 20px;  overflow: hidden;">
    <h5 class="text-info pull-left">
      通道自定义配置
      <span class="">
       [ {{ code }} ]
      </span>
    </h5>

    <div class="pull-right flex flex-row">
      <div class="ml-3" >
        <a [routerLink]="['/admin/terminal/dashboard']" class="btn btn-info" style="color: #ffffff;">
          <i class="fa fa-reply"></i>
          返回
        </a>
      </div>
    </div>

  </div>


  <div class="pb-3 mb-5">
    <!--模拟通道-->
    <div class="conf_confirm">
      <h6 class="pb-1 pt-3 text-muted">模拟通道</h6>
      <table class="table table-striped table-hover table-bordered">
        <thead class="bg_light_primary">
        <tr>
          <th>通道</th>
          <th colspan="2">参数名称</th>
          <th style="width: 100px;">换算比例</th>
          <th>参数单位</th>
          <!--<th colspan="2">告警阀值</th>-->
          <th style="width: 12%;">功能码</th>
          <th style="width: 12%;">高低字节</th>
          <th>MODBUS地址</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of analogueList; let i = index">
          <td width="10%"
              style="color: #555; text-align: center; border: 1px solid #ccc; ">
            通道
            <input type="number" [(ngModel)]="data.ChannelNumber" max="24"
                   style="display: inline-block; width: 50%;" class="form-control">
          </td>
          <td>
            <button [matMenuTriggerFor]="menu" class="btn" [disabled]="!data.Parameter||!data.Parameter.Name"
                    [ngClass]="{'btn-info': data.Status === 1, 'btn-danger': data.Status === 2}">
              <i class="fa" [ngClass]="{'fa-ellipsis-h':data.Status === 0, 'fa-eye': data.Status === 1, 'fa-eye-slash': data.Status === 2}"></i>
              <span *ngIf="data.Status === 1">{{ data.SequenceNumber }}</span>
            </button>
            <mat-menu #menu="matMenu" [overlapTrigger]="false">
              <button mat-menu-item [matMenuTriggerFor]="subMenu"><i class="fa fa-eye"></i>位置</button>
              <button mat-menu-item (click)="setStatus(data, 2)"><i class="fa fa-eye-slash"></i> 隐藏</button>
              <button mat-menu-item (click)="setStatus(data, 0)"><i class="fa fa-ellipsis-h"></i> 默认</button>
            </mat-menu>
            <mat-menu #subMenu="matMenu">
              <mat-grid-list cols="4" rowHeight="34px;">
                <mat-grid-tile
                  *ngFor="let priority of priorities" (click)="setStatus(data, 1, priority)">
                  {{ priority }}
                </mat-grid-tile>
              </mat-grid-list>
            </mat-menu>

          </td>
          <td>
              <input type="text" [(ngModel)]="data.Parameter.Name" (change)="dataChanged(data);"
                     class="form-control" placeholder="{{data.Parameter.Name||'未配置'}}">
          </td>
          <td>
            <input type="number" [(ngModel)]="data.Parameter.Scale" class="form-control" min="0" step="0.01"
                   placeholder="未配置" [disabled]="!data.Parameter||!data.Parameter.Name">
          </td>
          <td>
            <input type="text" [(ngModel)]="data.Parameter.Unit" class="form-control"
                   placeholder="未配置" [disabled]="!data.Parameter||!data.Parameter.Name">
          </td>

          <td>
            <select [(ngModel)]="data.Func" [disabled]="!data.Parameter||!data.Parameter.Name"
                    class="form-control">
              <option *ngFor="let fc of funcs" [value]="fc.Id" >{{fc.Name}}</option>
            </select>
          </td>
          <td>
            <select [(ngModel)]="data.Byte" [disabled]="!data.Parameter||!data.Parameter.Name"
                    class="form-control">
              <option *ngFor="let by of bytes" [value]="by.Id" >{{by.Name}}</option>
            </select>
          </td>
          <td>
            <input type="number" [(ngModel)]="data.Modbus" placeholder="未配置"
                   [disabled]="!data.Parameter||!data.Parameter.Name"
                   [ngbPopover]="modbusTips1" triggers="mouseenter:mouseleave" popoverTitle="范围说明"
                   class="form-control">

          </td>
          <td class="flex">
            <button type="button" class="btn btn-sm btn-outline-info"
                    triggers="mouseenter:mouseleave" ngbPopover="编辑告警规则" (click)="addAlarmRule(data)">
              <i class="fa fa-bell"></i>
            </button>
            <button type="button"  (click)="removeAnalogue(i)"
                    class="btn btn-sm btn-outline-danger ml-2 mr-2">
              <i class="fa fa-minus" style="font-size: 12px;"></i>
            </button>
          </td>
        </tr>
        </tbody>

      </table>
      <button type="button" (click)="addAnalogue()"
              *ngIf="analogueList.length < 24 "
              class="btn btn-info"
              style="width: 100%;">
        <i class="fa fa-plus-circle"></i>
        添加模拟通道
      </button>
    </div>


    <!--开关通道-->
    <div class="conf_confirm">
      <h6 class="pb-1 pt-3 text-muted">开关通道</h6>
      <table class="table table-striped table-hover table-bordered">
        <thead class="bg_light_primary">
        <tr>
          <th>通道</th>
          <th colspan="2">参数名称</th>
          <th style="width: 12%;">功能码</th>
          <th style="width: 12%;">MODBUS地址</th>
          <th>位地址</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of switchList; let i = index">
          <td width="10%"
              style="color: #555; text-align: center; border: 1px solid #ccc; ">
            通道
            <input type="number" [(ngModel)]="data.ChannelNumber" max="48"
                   style="display: inline-block; width: 50%;" class="form-control">
          </td>
          <td>
            <button [matMenuTriggerFor]="menu" class="btn btn-block" [disabled]="!data.Parameter||!data.Parameter.Name"
                    [ngClass]="{'btn-info': data.Status === 1, 'btn-danger': data.Status === 2}">
              <i class="fa" [ngClass]="{'fa-ellipsis-h':data.Status === 0, 'fa-eye': data.Status === 1, 'fa-eye-slash': data.Status === 2}"></i>
              <span *ngIf="data.Status === 1">{{ data.SequenceNumber }}</span>
            </button>
            <mat-menu #menu="matMenu" [overlapTrigger]="false">
              <button mat-menu-item [matMenuTriggerFor]="subMenu"><i class="fa fa-eye"></i>位置</button>
              <button mat-menu-item (click)="setStatus(data, 2)"><i class="fa fa-eye-slash"></i> 隐藏</button>
              <button mat-menu-item (click)="setStatus(data, 0)"><i class="fa fa-ellipsis-h"></i> 默认</button>
            </mat-menu>
            <mat-menu #subMenu="matMenu">
              <mat-grid-list cols="4" rowHeight="34px;">
                <mat-grid-tile
                  *ngFor="let priority of priorities" (click)="setStatus(data, 1, priority)">
                  {{ priority }}
                </mat-grid-tile>
              </mat-grid-list>
            </mat-menu>

          </td>
          <td>
            <input type="text" [(ngModel)]="data.Parameter.Name" (change)="dataChanged(data);"
                   class="form-control" placeholder="{{data.Parameter.Name||'未配置'}}">
          </td>


          <td>
            <select [(ngModel)]="data.Func" [disabled]="!data.Parameter||!data.Parameter.Name"
                    class="form-control">
              <option *ngFor="let fc of funcs" [value]="fc.Id" >{{fc.Name}}</option>
            </select>
          </td>
          <td>
            <input type="number" [(ngModel)]="data.Modbus" placeholder="未配置"
                   [disabled]="!data.Parameter||!data.Parameter.Name"
                   [ngbPopover]="modbusTips2" triggers="mouseenter:mouseleave" popoverTitle="范围说明"
                   class="form-control">
          </td>
          <td>
            <input type="number" [(ngModel)]="data.BitAddress" placeholder="未配置"
                   [disabled]="!data.Parameter||!data.Parameter.Name"
                   [ngbPopover]="bitAddressTips" triggers="mouseenter:mouseleave" popoverTitle="范围说明"
                   class="form-control">

          </td>
          <td class="flex">
            <button type="button" class="btn btn-sm btn-outline-info"
                    triggers="mouseenter:mouseleave" ngbPopover="编辑告警规则" (click)="addAlarmRule(data)">
              <i class="fa fa-bell"></i>
            </button>
            <button type="button"  (click)="removeSwitch(i)"
                    class="btn btn-sm btn-outline-danger ml-2 mr-2">
              <i class="fa fa-minus" style="font-size: 12px;"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
      <button type="button" (click)="addSwitch()"
              *ngIf="switchList.length < 48 "
              class="btn btn-info btn-block">
        <i class="fa fa-plus-circle"></i>
        添加开关通道
      </button>
    </div>



  </div>

</div>


<ng-template #modbusTips1>
  功能码03对应范围 <b>40001-49999</b>
  <br/>
  功能码04对应范围 <b>30001-39999</b>
</ng-template>

<ng-template #modbusTips2>
  功能码01对应范围 <b>00001-09999</b>
  <br/>
  功能码02对应范围 <b>10001-19999</b>
  <br/>
  功能码03对应范围 <b>40001-49999</b>
</ng-template>

<ng-template #bitAddressTips>
  功能码01对应位地址 <b>1</b>
  <br/>
  功能码02对应位地址 <b>1</b>
  <br/>
  功能码03对应位地址 <b>1-16</b>
</ng-template>
